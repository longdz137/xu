<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Qu·∫£n L√Ω ƒê∆°n H√†ng</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --dark-color: #2c3e50;
            --light-color: #ecf0f1;
            --card-bg: #ffffff;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            --radius: 12px;
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 25px 30px;
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            transform: rotate(30deg);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 1;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo h1 {
            font-size: 28px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .logo-icon {
            font-size: 36px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            transition: var(--transition);
            border: none;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: 0.5s;
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(52, 152, 219, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger-color), #c0392b);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, var(--warning-color), #e67e22);
            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            box-shadow: 0 5px 15px rgba(149, 165, 166, 0.3);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .section {
            padding: 30px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            text-align: center;
            transition: var(--transition);
            border-top: 4px solid var(--primary-color);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card.pending {
            border-top-color: var(--warning-color);
        }
        
        .stat-card.completed {
            border-top-color: var(--secondary-color);
        }
        
        .stat-card.cancelled {
            border-top-color: var(--danger-color);
        }
        
        .stat-number {
            font-size: 36px;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .stat-label {
            font-size: 16px;
            color: #7f8c8d;
            font-weight: 600;
        }
        
        .search-box {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e9ecef;
            border-radius: 50px;
            font-size: 16px;
            transition: var(--transition);
            background: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            margin-bottom: 25px;
        }
        
        .search-box:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 10px 20px;
            border: 2px solid #e9ecef;
            border-radius: 50px;
            background: white;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
        }
        
        .filter-btn:hover, .filter-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .order-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 20px;
        }
        
        .order-card {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border-left: 5px solid var(--primary-color);
            position: relative;
            overflow: hidden;
        }
        
        .order-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
        }
        
        .order-card.pending {
            border-left-color: var(--warning-color);
        }
        
        .order-card.completed {
            border-left-color: var(--secondary-color);
        }
        
        .order-card.cancelled {
            border-left-color: var(--danger-color);
        }
        
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .order-id {
            font-weight: 700;
            font-size: 18px;
            color: var(--dark-color);
        }
        
        .order-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-pending {
            background: rgba(243, 156, 18, 0.1);
            color: var(--warning-color);
        }
        
        .status-completed {
            background: rgba(46, 204, 113, 0.1);
            color: var(--secondary-color);
        }
        
        .status-cancelled {
            background: rgba(231, 76, 60, 0.1);
            color: var(--danger-color);
        }
        
        .order-details {
            margin-bottom: 20px;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #f1f1f1;
        }
        
        .detail-label {
            font-weight: 600;
            color: #7f8c8d;
        }
        
        .detail-value {
            font-weight: 500;
        }
        
        .order-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn-complete {
            background: rgba(46, 204, 113, 0.1);
            color: var(--secondary-color);
        }
        
        .btn-complete:hover {
            background: var(--secondary-color);
            color: white;
        }
        
        .btn-cancel {
            background: rgba(231, 76, 60, 0.1);
            color: var(--danger-color);
        }
        
        .btn-cancel:hover {
            background: var(--danger-color);
            color: white;
        }
        
        .btn-pending {
            background: rgba(243, 156, 18, 0.1);
            color: var(--warning-color);
        }
        
        .btn-pending:hover {
            background: var(--warning-color);
            color: white;
        }
        
        .btn-delete {
            background: rgba(231, 76, 60, 0.1);
            color: var(--danger-color);
        }
        
        .btn-delete:hover {
            background: var(--danger-color);
            color: white;
        }
        
        .btn-export {
            background: rgba(52, 152, 219, 0.1);
            color: var(--primary-color);
        }
        
        .btn-export:hover {
            background: var(--primary-color);
            color: white;
        }
        
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: #7f8c8d;
        }
        
        .empty-state i {
            font-size: 60px;
            margin-bottom: 20px;
            color: #bdc3c7;
        }
        
        .action-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .bulk-actions {
            display: flex;
            gap: 10px;
        }
        
        .export-options {
            display: flex;
            gap: 10px;
        }
        
        @media (max-width: 768px) {
            .order-grid {
                grid-template-columns: 1fr;
            }
            
            .stats {
                grid-template-columns: 1fr;
            }
            
            .action-bar {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .bulk-actions, .export-options {
                width: 100%;
                justify-content: space-between;
            }
        }
        
        .floating-card {
            animation: float-card 6s ease-in-out infinite;
        }
        
        @keyframes float-card {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: var(--shadow);
            animation: modalFadeIn 0.3s ease;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 700;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #7f8c8d;
        }
        
        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 25px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="glass-card floating-card">
            <header>
                <div class="header-content">
                    <div class="logo">
                        <div class="logo-icon"><i class="fas fa-cogs"></i></div>
                        <h1>Admin Dashboard - Qu·∫£n L√Ω ƒê∆°n H√†ng</h1>
                    </div>
                    <div>
                        <button class="btn btn-secondary" onclick="refreshData()">
                            <i class="fas fa-sync-alt"></i> L√†m M·ªõi
                        </button>
                    </div>
                </div>
            </header>

            <section class="section">
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-label">T·ªïng ƒê∆°n H√†ng</div>
                        <div class="stat-number" id="total-orders">0</div>
                        <div><i class="fas fa-shopping-cart fa-2x" style="color: var(--primary-color);"></i></div>
                    </div>
                    <div class="stat-card pending">
                        <div class="stat-label">ƒêang Ch·ªù X·ª≠ L√Ω</div>
                        <div class="stat-number" id="pending-orders">0</div>
                        <div><i class="fas fa-clock fa-2x" style="color: var(--warning-color);"></i></div>
                    </div>
                    <div class="stat-card completed">
                        <div class="stat-label">ƒê√£ Ho√†n Th√†nh</div>
                        <div class="stat-number" id="completed-orders">0</div>
                        <div><i class="fas fa-check-circle fa-2x" style="color: var(--secondary-color);"></i></div>
                    </div>
                    <div class="stat-card cancelled">
                        <div class="stat-label">ƒê√£ H·ªßy</div>
                        <div class="stat-number" id="cancelled-orders">0</div>
                        <div><i class="fas fa-times-circle fa-2x" style="color: var(--danger-color);"></i></div>
                    </div>
                </div>
                
                <div class="action-bar">
                    <div class="bulk-actions">
                        <button class="btn" onclick="selectAllOrders()">
                            <i class="fas fa-check-square"></i> Ch·ªçn T·∫•t C·∫£
                        </button>
                        <button class="btn btn-danger" onclick="deleteSelectedOrders()">
                            <i class="fas fa-trash"></i> X√≥a ƒê√£ Ch·ªçn
                        </button>
                    </div>
                    
                    <div class="export-options">
                        <button class="btn btn-warning" onclick="exportToExcel()">
                            <i class="fas fa-file-excel"></i> Xu·∫•t Excel
                        </button>
                        <button class="btn btn-secondary" onclick="exportToPDF()">
                            <i class="fas fa-file-pdf"></i> Xu·∫•t PDF
                        </button>
                    </div>
                </div>
                
                <input type="text" class="search-box" placeholder="üîç T√¨m ki·∫øm theo m√£ GD, t√™n TK, SƒêT..." onkeyup="filterOrders()">
                
                <div class="filters">
                    <button class="filter-btn active" onclick="setFilter('all')">T·∫•t C·∫£</button>
                    <button class="filter-btn" onclick="setFilter('pending')">ƒêang Ch·ªù</button>
                    <button class="filter-btn" onclick="setFilter('completed')">Ho√†n Th√†nh</button>
                    <button class="filter-btn" onclick="setFilter('cancelled')">ƒê√£ H·ªßy</button>
                </div>
                
                <div id="orders" class="order-grid">
                    <!-- Orders will be loaded here -->
                </div>
            </section>
        </div>
    </div>
    
    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">X√°c Nh·∫≠n X√≥a</div>
                <button class="close-modal" onclick="closeModal('deleteModal')">&times;</button>
            </div>
            <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ƒë∆°n h√†ng n√†y? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.</p>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal('deleteModal')">H·ªßy</button>
                <button class="btn btn-danger" id="confirmDelete">X√≥a</button>
            </div>
        </div>
    </div>
    
    <!-- Bulk Delete Confirmation Modal -->
    <div id="bulkDeleteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">X√°c Nh·∫≠n X√≥a H√†ng Lo·∫°t</div>
                <button class="close-modal" onclick="closeModal('bulkDeleteModal')">&times;</button>
            </div>
            <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a <span id="selectedCount">0</span> ƒë∆°n h√†ng ƒë√£ ch·ªçn? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.</p>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal('bulkDeleteModal')">H·ªßy</button>
                <button class="btn btn-danger" id="confirmBulkDelete">X√≥a T·∫•t C·∫£</button>
            </div>
        </div>
    </div>

    <script>
        let currentFilter = 'all';
        let selectedOrders = new Set();
        let ordersData = [];
        
        // Kh·ªüi t·∫°o trang
        document.addEventListener('DOMContentLoaded', function() {
            loadOrders();
            setInterval(loadOrders, 5000); // C·∫≠p nh·∫≠t m·ªói 5 gi√¢y
        });
        
        // T·∫£i danh s√°ch ƒë∆°n h√†ng
        function loadOrders() {
            const history = JSON.parse(localStorage.getItem('rechargeHistory') || '[]');
            ordersData = history;
            updateStats(history);
            renderOrders(history);
        }
        
        // C·∫≠p nh·∫≠t th·ªëng k√™
        function updateStats(history) {
            const total = history.length;
            const pending = history.filter(o => o.status === 'pending').length;
            const completed = history.filter(o => o.status === 'completed').length;
            const cancelled = history.filter(o => o.status === 'cancelled').length;
            
            document.getElementById('total-orders').textContent = total;
            document.getElementById('pending-orders').textContent = pending;
            document.getElementById('completed-orders').textContent = completed;
            document.getElementById('cancelled-orders').textContent = cancelled;
        }
        
        // Hi·ªÉn th·ªã ƒë∆°n h√†ng
        function renderOrders(orders) {
            const filteredOrders = filterOrdersByStatus(orders);
            
            if (filteredOrders.length === 0) {
                document.getElementById('orders').innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <h3>Kh√¥ng c√≥ ƒë∆°n h√†ng n√†o</h3>
                        <p>Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng ph√π h·ª£p v·ªõi ti√™u ch√≠ t√¨m ki·∫øm</p>
                    </div>
                `;
                return;
            }
            
            const ordersHtml = filteredOrders.map(order => `
                <div class="order-card ${order.status}" data-id="${order.transactionId}" data-username="${order.username}" data-phone="${order.phone}">
                    <div class="order-header">
                        <div class="order-id">${order.transactionId}</div>
                        <div class="order-status ${getStatusClass(order.status)}">${getStatusText(order.status)}</div>
                    </div>
                    
                    <div class="order-details">
                        <div class="detail-row">
                            <span class="detail-label">T√†i kho·∫£n:</span>
                            <span class="detail-value">${order.username}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">S·ªë ƒëi·ªán tho·∫°i:</span>
                            <span class="detail-value">${order.phone}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">S·ªë ti·ªÅn:</span>
                            <span class="detail-value">${parseInt(order.amount).toLocaleString('vi-VN')} VNƒê</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">S·ªë xu:</span>
                            <span class="detail-value">${order.coins}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Ph∆∞∆°ng th·ª©c:</span>
                            <span class="detail-value">${getPaymentText(order.payment)}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Th·ªùi gian:</span>
                            <span class="detail-value">${new Date(order.timestamp).toLocaleString('vi-VN')}</span>
                        </div>
                    </div>
                    
                    <div class="order-actions">
                        <button class="action-btn btn-complete" onclick="quickUpdate('${order.transactionId}', 'completed')">
                            <i class="fas fa-check"></i> Ho√†n th√†nh
                        </button>
                        <button class="action-btn btn-cancel" onclick="quickUpdate('${order.transactionId}', 'cancelled')">
                            <i class="fas fa-times"></i> H·ªßy
                        </button>
                        <button class="action-btn btn-pending" onclick="quickUpdate('${order.transactionId}', 'pending')">
                            <i class="fas fa-clock"></i> Ch·ªù
                        </button>
                        <button class="action-btn btn-export" onclick="exportOrder('${order.transactionId}')">
                            <i class="fas fa-download"></i> Xu·∫•t
                        </button>
                        <button class="action-btn btn-delete" onclick="confirmDelete('${order.transactionId}')">
                            <i class="fas fa-trash"></i> X√≥a
                        </button>
                        <label class="action-btn" style="cursor: pointer;">
                            <input type="checkbox" class="order-checkbox" value="${order.transactionId}" onchange="toggleOrderSelection('${order.transactionId}', this.checked)">
                            Ch·ªçn
                        </label>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('orders').innerHTML = ordersHtml;
        }
        
        // L·ªçc ƒë∆°n h√†ng theo tr·∫°ng th√°i
        function filterOrdersByStatus(orders) {
            if (currentFilter === 'all') return orders;
            return orders.filter(order => order.status === currentFilter);
        }
        
        // ƒê·∫∑t b·ªô l·ªçc
        function setFilter(status) {
            currentFilter = status;
            
            // C·∫≠p nh·∫≠t n√∫t active
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            renderOrders(ordersData);
        }
        
        // T√¨m ki·∫øm ƒë∆°n h√†ng
        function filterOrders() {
            const search = document.querySelector('.search-box').value.toLowerCase();
            const orders = document.querySelectorAll('.order-card');
            
            orders.forEach(order => {
                const id = order.dataset.id.toLowerCase();
                const username = order.dataset.username.toLowerCase();
                const phone = order.dataset.phone.toLowerCase();
                
                if (id.includes(search) || username.includes(search) || phone.includes(search)) {
                    order.style.display = 'block';
                } else {
                    order.style.display = 'none';
                }
            });
        }
        
        // C·∫≠p nh·∫≠t nhanh tr·∫°ng th√°i
        function quickUpdate(transactionId, status) {
            let history = JSON.parse(localStorage.getItem('rechargeHistory') || '[]');
            const orderIndex = history.findIndex(o => o.transactionId === transactionId);
            if (orderIndex !== -1) {
                history[orderIndex].status = status;
                history[orderIndex].statusUpdatedAt = new Date().toISOString();
                localStorage.setItem('rechargeHistory', JSON.stringify(history));
                
                // C·∫≠p nh·∫≠t giao di·ªán ngay l·∫≠p t·ª©c
                loadOrders();
                
                console.log(`‚ö° ƒê√£ c·∫≠p nh·∫≠t ${transactionId} th√†nh ${status}`);
            }
        }
        
        // X√°c nh·∫≠n x√≥a ƒë∆°n h√†ng
        function confirmDelete(transactionId) {
            document.getElementById('confirmDelete').onclick = function() {
                deleteOrder(transactionId);
                closeModal('deleteModal');
            };
            openModal('deleteModal');
        }
        
        // X√≥a ƒë∆°n h√†ng
        function deleteOrder(transactionId) {
            let history = JSON.parse(localStorage.getItem('rechargeHistory') || '[]');
            history = history.filter(order => order.transactionId !== transactionId);
            localStorage.setItem('rechargeHistory', JSON.stringify(history));
            
            // C·∫≠p nh·∫≠t giao di·ªán
            loadOrders();
            
            console.log(`üóëÔ∏è ƒê√£ x√≥a ƒë∆°n h√†ng ${transactionId}`);
        }
        
        // Ch·ªçn/b·ªè ch·ªçn ƒë∆°n h√†ng
        function toggleOrderSelection(transactionId, isSelected) {
            if (isSelected) {
                selectedOrders.add(transactionId);
            } else {
                selectedOrders.delete(transactionId);
            }
        }
        
        // Ch·ªçn t·∫•t c·∫£ ƒë∆°n h√†ng
        function selectAllOrders() {
            const checkboxes = document.querySelectorAll('.order-checkbox');
            const allSelected = checkboxes.length > 0 && Array.from(checkboxes).every(cb => cb.checked);
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = !allSelected;
                toggleOrderSelection(checkbox.value, !allSelected);
            });
        }
        
        // X√°c nh·∫≠n x√≥a h√†ng lo·∫°t
        function deleteSelectedOrders() {
            if (selectedOrders.size === 0) {
                alert('Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt ƒë∆°n h√†ng ƒë·ªÉ x√≥a');
                return;
            }
            
            document.getElementById('selectedCount').textContent = selectedOrders.size;
            document.getElementById('confirmBulkDelete').onclick = function() {
                bulkDeleteOrders();
                closeModal('bulkDeleteModal');
            };
            openModal('bulkDeleteModal');
        }
        
        // X√≥a h√†ng lo·∫°t
        function bulkDeleteOrders() {
            let history = JSON.parse(localStorage.getItem('rechargeHistory') || '[]');
            history = history.filter(order => !selectedOrders.has(order.transactionId));
            localStorage.setItem('rechargeHistory', JSON.stringify(history));
            
            // X√≥a danh s√°ch ƒë√£ ch·ªçn
            selectedOrders.clear();
            
            // C·∫≠p nh·∫≠t giao di·ªán
            loadOrders();
            
            console.log(`üóëÔ∏è ƒê√£ x√≥a ${selectedOrders.size} ƒë∆°n h√†ng`);
        }
        
        // Xu·∫•t ƒë∆°n h√†ng ra Excel
        function exportToExcel() {
            const orders = JSON.parse(localStorage.getItem('rechargeHistory') || '[]');
            if (orders.length === 0) {
                alert('Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ xu·∫•t');
                return;
            }
            
            // T·∫°o d·ªØ li·ªáu CSV
            let csvContent = "M√£ GD,T√†i kho·∫£n,SƒêT,S·ªë ti·ªÅn,Xu,Ph∆∞∆°ng th·ª©c,Tr·∫°ng th√°i,Th·ªùi gian\n";
            
            orders.forEach(order => {
                const row = [
                    order.transactionId,
                    order.username,
                    order.phone,
                    order.amount,
                    order.coins,
                    getPaymentText(order.payment),
                    getStatusText(order.status),
                    new Date(order.timestamp).toLocaleString('vi-VN')
                ];
                csvContent += row.join(",") + "\n";
            });
            
            // T·∫°o file v√† t·∫£i xu·ªëng
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", `don_hang_${new Date().toISOString().slice(0,10)}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            console.log('üìä ƒê√£ xu·∫•t d·ªØ li·ªáu ra Excel');
        }
        
        // Xu·∫•t ƒë∆°n h√†ng ra PDF
        function exportToPDF() {
            alert('T√≠nh nƒÉng xu·∫•t PDF ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn');
            // Trong th·ª±c t·∫ø, b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng th∆∞ vi·ªán nh∆∞ jsPDF
        }
        
        // Xu·∫•t m·ªôt ƒë∆°n h√†ng c·ª• th·ªÉ
        function exportOrder(transactionId) {
            const order = ordersData.find(o => o.transactionId === transactionId);
            if (!order) return;
            
            // T·∫°o n·ªôi dung cho ƒë∆°n h√†ng
            const content = `
                M√£ giao d·ªãch: ${order.transactionId}
                T√†i kho·∫£n: ${order.username}
                S·ªë ƒëi·ªán tho·∫°i: ${order.phone}
                S·ªë ti·ªÅn: ${parseInt(order.amount).toLocaleString('vi-VN')} VNƒê
                S·ªë xu: ${order.coins}
                Ph∆∞∆°ng th·ª©c: ${getPaymentText(order.payment)}
                Tr·∫°ng th√°i: ${getStatusText(order.status)}
                Th·ªùi gian: ${new Date(order.timestamp).toLocaleString('vi-VN')}
            `;
            
            // T·∫°o file v√† t·∫£i xu·ªëng
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", `don_hang_${order.transactionId}.txt`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            console.log(`üìÑ ƒê√£ xu·∫•t ƒë∆°n h√†ng ${transactionId}`);
        }
        
        // L√†m m·ªõi d·ªØ li·ªáu
        function refreshData() {
            loadOrders();
            alert('ƒê√£ l√†m m·ªõi d·ªØ li·ªáu');
        }
        
        // M·ªü modal
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }
        
        // ƒê√≥ng modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // C√°c h√†m ti·ªán √≠ch
        function getPaymentText(payment) {
            const methods = {
                'momo': 'MoMo',
                'zalo': 'ZaloPay', 
                'bank': 'Chuy·ªÉn kho·∫£n',
                'card': 'Th·∫ª c√†o'
            };
            return methods[payment] || payment;
        }
        
        function getStatusText(status) {
            const texts = {
                'completed': '‚úÖ Ho√†n th√†nh',
                'pending': '‚è≥ ƒêang ch·ªù',
                'cancelled': '‚ùå ƒê√£ h·ªßy'
            };
            return texts[status] || status;
        }
        
        function getStatusClass(status) {
            const classes = {
                'completed': 'status-completed',
                'pending': 'status-pending',
                'cancelled': 'status-cancelled'
            };
            return classes[status] || '';
        }
    </script>
</body>
</html>
