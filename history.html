<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L·ªãch S·ª≠ N·∫°p Ti·ªÅn - TikTok Coin</title>
    <style>
        :root {
            --primary-color: #fe2c55;
            --secondary-color: #25f4ee;
            --dark-color: #121212;
            --light-color: #ffffff;
            --gray-color: #f8f9fa;
            --text-color: #333333;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--gray-color);
            color: var(--text-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--light-color);
            padding: 20px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo h1 {
            font-size: 24px;
            font-weight: 700;
        }
        
        .logo-icon {
            font-size: 28px;
        }
        
        nav ul {
            display: flex;
            list-style: none;
            gap: 20px;
        }
        
        nav a {
            color: var(--light-color);
            text-decoration: none;
            font-weight: 500;
            transition: opacity 0.3s;
        }
        
        nav a:hover {
            opacity: 0.8;
        }
        
        .btn {
            display: inline-block;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--light-color);
            padding: 12px 30px;
            border-radius: 30px;
            text-decoration: none;
            font-weight: 600;
            transition: transform 0.3s, box-shadow 0.3s;
            border: none;
            cursor: pointer;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .section {
            padding: 60px 0;
        }
        
        .section-title {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .section-title h2 {
            font-size: 36px;
            color: var(--dark-color);
            margin-bottom: 15px;
        }
        
        .section-title p {
            color: #666;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .search-container {
            background: var(--light-color);
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            max-width: 600px;
            margin: 0 auto 40px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border 0.3s;
        }
        
        .form-control:focus {
            border-color: var(--primary-color);
            outline: none;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: var(--light-color);
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            text-align: center;
        }
        
        .stat-icon {
            font-size: 40px;
            margin-bottom: 15px;
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 14px;
        }
        
        .history-container {
            background: var(--light-color);
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .history-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .history-header h3 {
            color: var(--dark-color);
        }
        
        .filter-buttons {
            display: flex;
            gap: 10px;
        }
        
        .filter-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            border-radius: 20px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .filter-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .history-list {
            max-height: 600px;
            overflow-y: auto;
        }
        
        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.3s;
        }
        
        .history-item:hover {
            background-color: #f8f9fa;
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .transaction-info {
            flex: 1;
        }
        
        .transaction-main {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .transaction-id {
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .transaction-amount {
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .transaction-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            font-size: 14px;
            color: #666;
        }
        
        .transaction-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
            min-width: 100px;
        }
        
        .status-completed {
            background: #d4edda;
            color: #155724;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-cancelled {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-expired {
            background: #e2e3e5;
            color: #383d41;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .empty-state .icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 30px;
        }
        
        .pagination-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .pagination-btn:hover:not(:disabled) {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .pagination-info {
            color: #666;
            font-size: 14px;
        }
        
        footer {
            background: var(--dark-color);
            color: var(--light-color);
            padding: 40px 0;
            text-align: center;
        }
        
        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .social-links {
            display: flex;
            gap: 15px;
        }
        
        .social-links a {
            color: var(--light-color);
            font-size: 20px;
            transition: color 0.3s;
        }
        
        .social-links a:hover {
            color: var(--secondary-color);
        }
        
        .copyright {
            margin-top: 20px;
            font-size: 14px;
            color: #aaa;
        }
        
        .notification {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
        }
        
        .notification.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            nav ul {
                gap: 15px;
            }
            
            .transaction-main {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .transaction-details {
                grid-template-columns: 1fr;
            }
            
            .history-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .filter-buttons {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">üéµ</div>
                    <h1>TikTok Coin - L·ªãch S·ª≠ N·∫°p Ti·ªÅn</h1>
                </div>
                <nav>
                    <ul>
                        <li><a href="index.html">Trang Ch·ªß</a></li>
                        <li><a href="index.html#recharge">N·∫°p Xu</a></li>
                        <li><a href="history.html" style="opacity: 1; font-weight: 700;">L·ªãch S·ª≠</a></li>
                        <li><a href="#contact">Li√™n H·ªá</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <section class="section">
        <div class="container">
            <div class="section-title">
                <h2>L·ªãch S·ª≠ N·∫°p Ti·ªÅn</h2>
                <p>Theo d√µi t·∫•t c·∫£ c√°c giao d·ªãch n·∫°p xu TikTok c·ªßa b·∫°n</p>
            </div>

            <div class="search-container">
                <div id="notification" class="notification error"></div>
                <div class="form-group">
                    <label for="search-phone">S·ªë ƒëi·ªán tho·∫°i ƒë·ªÉ tra c·ª©u</label>
                    <input type="tel" id="search-phone" class="form-control" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i ƒë√£ s·ª≠ d·ª•ng ƒë·ªÉ n·∫°p ti·ªÅn" required>
                </div>
                <button id="search-history" class="btn" style="width: 100%;">Tra C·ª©u L·ªãch S·ª≠</button>
            </div>

            <div id="stats-section" style="display: none;">
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-icon">üí∞</div>
                        <div class="stat-number" id="total-transactions">0</div>
                        <div class="stat-label">T·ªïng Giao D·ªãch</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üíé</div>
                        <div class="stat-number" id="total-amount">0</div>
                        <div class="stat-label">T·ªïng Ti·ªÅn ƒê√£ N·∫°p</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ü™ô</div>
                        <div class="stat-number" id="total-coins">0</div>
                        <div class="stat-label">T·ªïng Xu Nh·∫≠n ƒê∆∞·ª£c</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚úÖ</div>
                        <div class="stat-number" id="success-rate">0%</div>
                        <div class="stat-label">T·ª∑ L·ªá Th√†nh C√¥ng</div>
                    </div>
                </div>

                <div class="history-container">
                    <div class="history-header">
                        <h3>Chi Ti·∫øt Giao D·ªãch</h3>
                        <div class="filter-buttons">
                            <button class="filter-btn active" data-filter="all">T·∫•t C·∫£</button>
                            <button class="filter-btn" data-filter="completed">Th√†nh C√¥ng</button>
                            <button class="filter-btn" data-filter="pending">ƒêang Ch·ªù</button>
                            <button class="filter-btn" data-filter="cancelled">ƒê√£ H·ªßy</button>
                        </div>
                    </div>

                    <div class="history-list" id="history-list">
                        <!-- History items will be loaded here -->
                    </div>

                    <div class="pagination">
                        <button class="pagination-btn" id="prev-page" disabled>‚Üê Tr∆∞·ªõc</button>
                        <span class="pagination-info" id="page-info">Trang 1/1</span>
                        <button class="pagination-btn" id="next-page" disabled>Ti·∫øp ‚Üí</button>
                    </div>
                </div>
            </div>

            <div id="empty-state" class="empty-state">
                <div class="icon">üìä</div>
                <h3>Ch∆∞a c√≥ d·ªØ li·ªáu</h3>
                <p>Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i ƒë·ªÉ xem l·ªãch s·ª≠ n·∫°p ti·ªÅn c·ªßa b·∫°n</p>
            </div>
        </div>
    </section>

    <footer id="contact">
        <div class="container">
            <div class="footer-content">
                <div class="logo">
                    <div class="logo-icon">üéµ</div>
                    <h1>TikTok Coin</h1>
                </div>
                <p>H·ªá th·ªëng n·∫°p xu TikTok t√≠ch h·ª£p th√¥ng b√°o Telegram</p>
                <div class="social-links">
                    <a href="#">üìò</a>
                    <a href="#">üì∑</a>
                    <a href="#">üê¶</a>
                    <a href="#">üí¨</a>
                </div>
                <div class="copyright">
                    &copy; 2023 TikTok Coin. T·∫•t c·∫£ c√°c quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Bi·∫øn to√†n c·ª•c
        let currentHistory = [];
        let filteredHistory = [];
        let currentFilter = 'all';
        let currentPage = 1;
        const itemsPerPage = 10;

        // Kh·ªüi t·∫°o trang
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            
            // Ki·ªÉm tra n·∫øu c√≥ s·ªë ƒëi·ªán tho·∫°i trong URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const phoneFromUrl = urlParams.get('phone');
            if (phoneFromUrl) {
                document.getElementById('search-phone').value = phoneFromUrl;
                searchHistory();
            }
        });

        // Thi·∫øt l·∫≠p event listeners
        function setupEventListeners() {
            // T√¨m ki·∫øm l·ªãch s·ª≠
            document.getElementById('search-history').addEventListener('click', searchHistory);
            
            // Enter ƒë·ªÉ t√¨m ki·∫øm
            document.getElementById('search-phone').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchHistory();
                }
            });
            
            // Filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentFilter = this.dataset.filter;
                    filterHistory();
                });
            });
            
            // Pagination
            document.getElementById('prev-page').addEventListener('click', goToPrevPage);
            document.getElementById('next-page').addEventListener('click', goToNextPage);
        }

        // T√¨m ki·∫øm l·ªãch s·ª≠
        function searchHistory() {
            const phone = document.getElementById('search-phone').value.trim();
            const notification = document.getElementById('notification');
            
            if (!phone) {
                notification.textContent = '‚ùå Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i ƒë·ªÉ tra c·ª©u';
                notification.style.display = 'block';
                return;
            }
            
            // Validate s·ªë ƒëi·ªán tho·∫°i
            if (!isValidPhone(phone)) {
                notification.textContent = '‚ùå S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá';
                notification.style.display = 'block';
                return;
            }
            
            notification.style.display = 'none';
            loadHistory(phone);
        }

        // Ki·ªÉm tra s·ªë ƒëi·ªán tho·∫°i h·ª£p l·ªá
        function isValidPhone(phone) {
            const phoneRegex = /^(0|\+84)(3[2-9]|5[2689]|7[06-9]|8[1-9]|9[0-9])[0-9]{7}$/;
            return phoneRegex.test(phone);
        }

        // Load l·ªãch s·ª≠ t·ª´ localStorage
        function loadHistory(phone) {
            const history = JSON.parse(localStorage.getItem('rechargeHistory') || '[]');
            currentHistory = history.filter(transaction => transaction.phone === phone);
            
            if (currentHistory.length === 0) {
                showEmptyState();
                return;
            }
            
            // S·∫Øp x·∫øp theo th·ªùi gian m·ªõi nh·∫•t
            currentHistory.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            showHistorySection();
            updateStats();
            filterHistory();
        }

        // Hi·ªÉn th·ªã section l·ªãch s·ª≠
        function showHistorySection() {
            document.getElementById('empty-state').style.display = 'none';
            document.getElementById('stats-section').style.display = 'block';
        }

        // Hi·ªÉn th·ªã tr·∫°ng th√°i tr·ªëng
        function showEmptyState() {
            document.getElementById('empty-state').style.display = 'block';
            document.getElementById('stats-section').style.display = 'none';
        }

        // C·∫≠p nh·∫≠t th·ªëng k√™
        function updateStats() {
            const totalTransactions = currentHistory.length;
            const totalAmount = currentHistory.reduce((sum, transaction) => sum + parseInt(transaction.amount), 0);
            const totalCoins = currentHistory.reduce((sum, transaction) => sum + parseInt(transaction.coins), 0);
            const completedTransactions = currentHistory.filter(t => t.status === 'completed').length;
            const successRate = totalTransactions > 0 ? Math.round((completedTransactions / totalTransactions) * 100) : 0;
            
            document.getElementById('total-transactions').textContent = totalTransactions;
            document.getElementById('total-amount').textContent = formatCurrency(totalAmount) + ' VNƒê';
            document.getElementById('total-coins').textContent = formatCurrency(totalCoins) + ' Xu';
            document.getElementById('success-rate').textContent = successRate + '%';
        }

        // L·ªçc l·ªãch s·ª≠
        function filterHistory() {
            if (currentFilter === 'all') {
                filteredHistory = [...currentHistory];
            } else {
                filteredHistory = currentHistory.filter(transaction => transaction.status === currentFilter);
            }
            
            currentPage = 1;
            renderHistory();
        }

        // Hi·ªÉn th·ªã l·ªãch s·ª≠
        function renderHistory() {
            const historyList = document.getElementById('history-list');
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageItems = filteredHistory.slice(startIndex, endIndex);
            
            if (pageItems.length === 0) {
                historyList.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üîç</div>
                        <h3>Kh√¥ng t√¨m th·∫•y giao d·ªãch</h3>
                        <p>Kh√¥ng c√≥ giao d·ªãch n√†o ph√π h·ª£p v·ªõi b·ªô l·ªçc hi·ªán t·∫°i</p>
                    </div>
                `;
            } else {
                historyList.innerHTML = pageItems.map(transaction => `
                    <div class="history-item">
                        <div class="transaction-info">
                            <div class="transaction-main">
                                <span class="transaction-id">${transaction.transactionId}</span>
                                <span class="transaction-amount">${formatCurrency(transaction.amount)} VNƒê</span>
                            </div>
                            <div class="transaction-details">
                                <div><strong>T√†i kho·∫£n:</strong> ${transaction.username}</div>
                                <div><strong>S·ªë xu:</strong> ${transaction.coins} Xu</div>
                                <div><strong>Ph∆∞∆°ng th·ª©c:</strong> ${getPaymentMethod(transaction.payment)}</div>
                                <div><strong>Th·ªùi gian:</strong> ${formatDate(transaction.timestamp)}</div>
                            </div>
                        </div>
                        <div class="transaction-status ${getStatusClass(transaction.status)}">
                            ${getStatusText(transaction.status)}
                        </div>
                    </div>
                `).join('');
            }
            
            updatePagination();
        }

        // C·∫≠p nh·∫≠t ph√¢n trang
        function updatePagination() {
            const totalPages = Math.ceil(filteredHistory.length / itemsPerPage);
            const pageInfo = document.getElementById('page-info');
            const prevBtn = document.getElementById('prev-page');
            const nextBtn = document.getElementById('next-page');
            
            pageInfo.textContent = `Trang ${currentPage}/${totalPages}`;
            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages || totalPages === 0;
        }

        // Chuy·ªÉn trang tr∆∞·ªõc
        function goToPrevPage() {
            if (currentPage > 1) {
                currentPage--;
                renderHistory();
            }
        }

        // Chuy·ªÉn trang ti·∫øp
        function goToNextPage() {
            const totalPages = Math.ceil(filteredHistory.length / itemsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                renderHistory();
            }
        }

        // H√†m utility: ƒê·ªãnh d·∫°ng ti·ªÅn t·ªá
        function formatCurrency(amount) {
            return parseInt(amount).toLocaleString('vi-VN');
        }

        // H√†m utility: ƒê·ªãnh d·∫°ng ng√†y th√°ng
        function formatDate(dateString) {
            return new Date(dateString).toLocaleString('vi-VN');
        }

        // H√†m utility: L·∫•y t√™n ph∆∞∆°ng th·ª©c thanh to√°n
        function getPaymentMethod(method) {
            const methods = {
                'momo': 'V√≠ MoMo',
                'zalo': 'V√≠ ZaloPay',
                'bank': 'Chuy·ªÉn kho·∫£n',
                'card': 'Th·∫ª c√†o'
            };
            return methods[method] || method;
        }

        // H√†m utility: L·∫•y class tr·∫°ng th√°i
        function getStatusClass(status) {
            const classes = {
                'completed': 'status-completed',
                'pending': 'status-pending',
                'cancelled': 'status-cancelled',
                'expired': 'status-expired'
            };
            return classes[status] || 'status-pending';
        }

        // H√†m utility: L·∫•y text tr·∫°ng th√°i
        function getStatusText(status) {
            const texts = {
                'completed': 'Th√†nh c√¥ng',
                'pending': 'ƒêang ch·ªù',
                'cancelled': 'ƒê√£ h·ªßy',
                'expired': 'H·∫øt h·∫°n'
            };
            return texts[status] || status;
        }

        // Xu·∫•t d·ªØ li·ªáu (cho admin)
        function exportHistory() {
            if (currentHistory.length === 0) {
                alert('Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ xu·∫•t');
                return;
            }
            
            const csv = convertToCSV(currentHistory);
            downloadCSV(csv, `lich_su_nap_tien_${document.getElementById('search-phone').value}.csv`);
        }

        // Chuy·ªÉn ƒë·ªïi sang CSV
        function convertToCSV(data) {
            const headers = ['M√£ GD', 'T√†i kho·∫£n', 'SƒêT', 'S·ªë ti·ªÅn', 'S·ªë xu', 'Ph∆∞∆°ng th·ª©c', 'Tr·∫°ng th√°i', 'Th·ªùi gian'];
            const rows = data.map(item => [
                item.transactionId,
                item.username,
                item.phone,
                item.amount,
                item.coins,
                getPaymentMethod(item.payment),
                getStatusText(item.status),
                formatDate(item.timestamp)
            ]);
            
            return [headers, ...rows].map(row => row.map(field => `"${field}"`).join(',')).join('\n');
        }

        // T·∫£i file CSV
        function downloadCSV(csv, filename) {
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Th√™m n√∫t export cho admin (c√≥ th·ªÉ ·∫©n ƒëi)
        function addExportButton() {
            const historyHeader = document.querySelector('.history-header');
            const exportBtn = document.createElement('button');
            exportBtn.className = 'btn btn-secondary';
            exportBtn.textContent = 'üì• Xu·∫•t CSV';
            exportBtn.onclick = exportHistory;
            historyHeader.appendChild(exportBtn);
        }

        // G·ªçi h√†m n√†y n·∫øu mu·ªën th√™m n√∫t export
        // addExportButton();
    </script>
</body>
</html>
